/* eslint-disable @next/next/no-img-element */

import type { NextRequest } from 'next/server';

import { ImageResponse } from 'next/og';

import { env } from '@/library/environment';
import { getPost } from '@/data/posts';

interface GetParams {
  params: {
    slug: string;
  };
}

export const runtime = 'edge';

export async function GET(_: NextRequest, { params }: GetParams) {
  const post = await getPost(params.slug);

  if (!post) {
    return new Response('Not found', { status: 404 });
  }

  const res = await fetch(new URL('inter-semibold.ttf', import.meta.url));
  const data = await res.arrayBuffer();

  return new ImageResponse(
    (
      <div
        tw="relative flex w-full h-full"
        style={{
          backgroundImage: 'linear-gradient(to bottom, #DD704D, #3E3F47)',
        }}
      >
        <div tw="absolute inset-8 rounded-[2.5rem] bg-white" />
        <img
          tw="absolute inset-x-12 top-12 rounded-[2rem]"
          src={post.image?.node.featured}
          width={1104}
          height={580}
          alt=""
        />
        <img
          tw="absolute inset-x-12 top-12 rounded-[2rem]"
          src={`${env.DOMAIN}/static/indaytrending-overlay.png`}
          width={1104}
          height={580}
          alt=""
        />
        <div tw="absolute inset-x-20 top-[42rem] text-white text-5xl font-bold text-[#3E3F47]">
          {post.title}
        </div>
        <div tw="absolute left-20 bottom-28 bg-[#DD704D] px-8 py-4 rounded-full font-bold text-3xl text-white">
          Link in Comment Below
        </div>
        <svg
          viewBox="0 0 480 240"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          style={{
            width: '360px',
            height: '180px',
            position: 'absolute',
            right: '80px',
            bottom: '48px',
          }}
        >
          <path d="M63.048 112.656H74.44V132.752H29V112.656H40.392V63.12H29.896V43.152H73.544V63.12H63.048V112.656Z" fill="#DD704D" />
          <path d="M155.088 132.88L109.904 88.72V132.752C101.968 132.752 94.032 132.752 86.224 132.752V42.768H94.544L139.856 87.056V43.152C147.664 43.152 155.472 43.152 163.28 43.152V132.88H155.088Z" fill="#DD704D" />
          <path d="M216.691 43.152C275.059 43.408 275.059 132.496 216.691 132.752H182.899V43.152H216.691ZM205.811 64.016V111.888H216.691C245.235 111.888 245.235 64.016 216.691 64.016H205.811Z" fill="#DD704D" />
          <path d="M331.659 132.752L326.411 121.488H291.083L285.835 132.752H263.435V129.424L303.755 42H313.611L354.059 129.424V132.752H331.659ZM318.859 101.776L308.619 78.224L298.635 101.776H318.859Z" fill="#DD704D" />
          <path d="M396.12 95.12V132.752H373.464V95.12L343.384 46.608V43.152H368.088L384.344 72.976H385.24L401.496 43.152H426.328V46.608L396.12 95.12Z" fill="#DD704D" />
          <path d="M202.672 91.4719C206.112 92.8319 208.272 99.8719 202.832 97.7119C187.392 91.5519 169.072 93.1519 152.832 93.3919C149.632 93.4719 146.512 93.5519 143.312 93.6319C144.832 94.9919 145.792 96.8319 145.152 98.1919C132.272 123.232 123.632 150.432 119.872 178.432C119.312 182.832 112.192 177.792 112.592 174.672C116.352 146.512 124.752 119.152 137.712 93.7919C124.912 94.1919 112.192 94.9119 99.392 95.8719C96.272 96.1119 91.312 88.9119 95.712 88.5919C114.592 87.1519 133.472 86.2719 152.352 86.1119C169.232 85.8719 186.752 85.0719 202.672 91.4719Z" fill="#3E3F47" />
          <path d="M175.236 140.832C176.116 142.352 175.796 144.192 173.956 144.352C172.436 144.512 171.076 143.472 170.036 142.272C168.276 142.272 164.276 145.232 163.236 146.032C161.236 147.552 159.396 149.312 157.716 151.152C153.876 155.232 150.676 159.792 148.356 164.832C146.756 168.432 140.196 162.672 141.316 159.712C144.356 151.632 147.636 143.712 150.596 135.632C151.636 132.672 156.596 136.032 157.556 139.072C163.796 134.272 170.516 132.832 175.236 140.832Z" fill="#3E3F47" />
          <path d="M218.599 141.632C221.479 139.392 225.959 144.272 223.319 145.952C212.519 152.992 201.159 161.152 188.839 165.472C184.359 167.152 179.719 167.392 176.519 163.152C171.559 156.512 177.959 146.832 182.439 141.952C186.519 137.472 193.719 132.432 199.079 138.112C206.839 146.192 188.599 153.232 183.719 155.552C183.719 155.632 183.719 155.632 183.639 155.632C183.239 156.592 182.919 157.632 182.599 158.672C190.759 157.632 210.519 147.872 218.599 141.632Z" fill="#3E3F47" />
          <path d="M274.047 141.072C277.007 139.712 280.207 144.512 276.767 146.112C269.647 149.472 263.007 153.552 256.367 157.712C252.207 160.272 247.647 163.872 242.847 164.992C238.047 166.112 233.647 161.632 234.367 156.912C234.767 154.192 235.887 151.472 237.247 148.832C229.407 153.152 222.527 158.832 216.687 165.792C214.367 168.592 209.327 162.512 209.967 160.032C211.727 153.072 215.087 146.352 218.607 140.112C220.527 136.672 227.247 142.512 225.727 145.232C225.567 145.472 225.487 145.632 225.407 145.792C231.567 141.552 238.287 138.272 245.487 136.032C248.527 135.072 253.007 139.872 251.247 142.752C248.847 146.592 246.847 150.512 244.847 154.512C254.367 149.792 264.687 145.472 274.047 141.072Z" fill="#3E3F47" />
          <path d="M328.801 80.5919C331.121 81.2319 333.761 84.1119 333.441 86.1119C333.441 86.3519 333.361 86.5119 333.281 86.6719C319.361 114.192 305.441 141.792 295.521 170.992C294.321 174.512 287.441 168.912 288.481 165.792C290.481 159.872 292.721 154.032 295.041 148.192C288.161 155.632 280.081 161.792 270.161 165.472C267.201 166.512 263.441 162.032 264.001 159.312C265.841 151.152 270.241 142.752 277.121 137.712C281.841 134.112 287.921 134.512 291.921 138.112C292.401 137.552 292.881 136.912 293.361 136.352C306.481 119.632 316.641 100.432 326.161 81.5519C326.241 81.3919 326.321 81.3119 326.401 81.2319C326.801 80.6719 327.281 80.4319 327.921 80.4319C327.921 80.4319 327.921 80.4319 328.001 80.4319C328.241 80.4319 328.561 80.5119 328.801 80.5919ZM275.121 153.872C280.081 150.832 284.481 146.752 288.321 142.352C288.241 142.272 288.081 142.272 288.001 142.192C287.441 142.352 286.881 142.432 286.401 142.512C284.881 142.832 283.521 143.872 282.401 144.912C280.561 146.432 278.881 148.272 277.441 150.192C276.561 151.392 275.761 152.592 275.121 153.872Z" fill="#3E3F47" />
          <path d="M343.504 141.872C346.224 139.552 350.624 143.712 348.064 145.872C343.664 149.632 339.024 153.232 334.224 156.512C330.304 159.072 325.904 162.272 321.184 163.232C315.904 164.352 310.784 159.392 310.704 154.032C310.544 148.032 315.104 141.072 318.064 136.032C319.984 132.592 326.704 138.432 325.104 141.152C322.784 145.232 320.704 149.152 319.104 153.552C318.864 154.112 318.624 154.672 318.464 155.312C323.984 154.272 337.104 147.232 343.504 141.872ZM331.824 127.552C330.784 131.072 323.824 125.552 324.784 122.352C326.544 116.512 328.864 110.912 331.824 105.552C333.744 102.112 340.464 107.952 338.944 110.672C335.984 116.112 333.584 121.712 331.824 127.552Z" fill="#3E3F47" />
          <path d="M399.125 141.072C402.085 139.712 405.285 144.512 401.845 146.112C394.725 149.472 388.085 153.552 381.445 157.712C377.285 160.272 372.725 163.872 367.925 164.992C363.125 166.112 358.725 161.632 359.445 156.912C359.845 154.192 360.965 151.472 362.325 148.832C354.485 153.152 347.605 158.832 341.765 165.792C339.445 168.592 334.405 162.512 335.045 160.032C336.805 153.072 340.165 146.352 343.685 140.112C345.605 136.672 352.325 142.512 350.805 145.232C350.645 145.472 350.565 145.632 350.485 145.792C356.645 141.552 363.365 138.272 370.565 136.032C373.605 135.072 378.085 139.872 376.325 142.752C373.925 146.592 371.925 150.512 369.925 154.512C379.445 149.792 389.765 145.472 399.125 141.072Z" fill="#3E3F47" />
          <path d="M446.599 140.112C449.559 138.752 453.559 144.832 450.039 146.352C438.919 151.312 428.6 157.952 419.799 166.272C413.559 183.792 406.519 200.992 398.599 217.792C396.919 221.392 392.199 215.952 391.559 214.192C385.879 199.072 394.04 182.992 403.24 171.072C406.2 167.232 409.479 163.632 412.999 160.352C413.959 157.472 414.999 154.512 415.959 151.632C409.239 156.192 403.479 162.432 395.799 165.472C392.919 166.592 389.079 161.952 389.639 159.312C391.479 151.152 395.879 142.752 402.759 137.712C408.359 133.552 415.639 134.752 419.399 140.272C419.719 140.192 420.039 140.112 420.359 140.032C423.079 139.312 427.319 143.312 426.439 146.192C426.039 147.552 425.559 148.992 425.079 150.432C432.919 146.032 439.719 143.152 446.599 140.112ZM402.759 150.672C406.519 147.712 410.119 144.592 414.359 142.432C414.119 142.352 413.879 142.272 413.639 142.192C413.079 142.352 412.519 142.432 412.039 142.512C410.519 142.832 409.159 143.872 408.039 144.912C406.199 146.432 404.519 148.272 403.079 150.192C402.999 150.352 402.839 150.512 402.759 150.672ZM398.919 196.272C399.799 194.112 400.759 191.952 401.639 189.792C400.599 191.872 399.639 194.112 398.919 196.272Z" fill="#3E3F47" />
        </svg>
      </div>
    ),
    {
      width: 1200,
      height: 1200,
      fonts: [
        {
          name: 'Inter',
          data,
          weight: 600,
        },
      ],
    },
  );
}
